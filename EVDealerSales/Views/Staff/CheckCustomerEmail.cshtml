@* EVDealerSales\Views\Staff\CheckCustomerEmail.cshtml *@
@{
    ViewData["Title"] = "Check Customer Email";
}
<h2>Enter your email to continue</h2>
<form id="checkEmailForm" autocomplete="off">
    <div class="form-group mb-2">
        <label for="customerEmail">Email</label>
        <input type="email" class="form-control" id="customerEmail" required />
        <span id="emailError" class="text-danger"></span>
    </div>
    <button type="submit" class="btn btn-primary">Continue</button>
</form>

@section Scripts {
    <script>
        document.getElementById('checkEmailForm').addEventListener('submit', function (e) {
            e.preventDefault();
            var email = document.getElementById('customerEmail').value;
            if (!email) {
                document.getElementById('emailError').innerText = "Email is required";
                return;
            }
            fetch('/Staff/CheckCustomerEmailApi?email=' + encodeURIComponent(email))
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        // Nếu đã tồn tại, chuyển sang trang đặt lịch
                        window.location.href = '/TestDrive/Schedule?email=' + encodeURIComponent(email);
                    } else {
                        // Nếu chưa tồn tại, chuyển sang form nhập thông tin khách hàng
                        window.location.href = '/Staff/AddCustomer?email=' + encodeURIComponent(email);
                    }
                });
        });
    </script>
}